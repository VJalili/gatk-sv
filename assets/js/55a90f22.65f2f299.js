"use strict";(self.webpackChunkGATK_SV=self.webpackChunkGATK_SV||[]).push([[4293],{4030:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>a});var i=n(4848),r=n(8453);n(1470),n(9365);const l={title:"Docker Images Hierarchy",description:"Docker Image Dependencies",sidebar_position:1},t=void 0,c={id:"advanced/docker/images",title:"Docker Images Hierarchy",description:"Docker Image Dependencies",source:"@site/docs/advanced/docker/images.md",sourceDirName:"advanced/docker",slug:"/advanced/docker/images",permalink:"/gatk-sv/docs/advanced/docker/images",draft:!1,unlisted:!1,editUrl:"https://github.com/broadinstitute/gatk-sv/tree/master/website/docs/advanced/docker/images.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Docker Images Hierarchy",description:"Docker Image Dependencies",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Overview",permalink:"/gatk-sv/docs/advanced/docker/"},next:{title:"Deploying Docker Images",permalink:"/gatk-sv/docs/advanced/docker/deploy/"}},d={},a=[{value:"Docker Images List",id:"list",level:2},{value:"Advantages of Dividing Images by Functionality",id:"advantages-of-dividing-images-by-functionality",level:2}];function o(e){const s={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",mermaid:"mermaid",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.admonition,{type:"info",children:(0,i.jsxs)(s.p,{children:["This page provides a detailed explanation of Docker\nimages and their hierarchy. For information on the process\nof building these images, please refer to ",(0,i.jsx)(s.a,{href:"/docs/advanced/docker/deploy",children:"this section"}),"."]})}),"\n",(0,i.jsx)(s.p,{children:"The tools, scripts, dependencies, and configurations utilized by the\nGATK-SV pipeline, written in WDL, are organized into separate Docker\ncontainers. This modular approach ensures that each container\ncontains only the necessary tools for its specific task,\nresulting in smaller image sizes. This design choice simplifies\nthe definition of Dockerfiles and facilitates easier maintenance.\nMoreover, the smaller image sizes contribute to reduced disk\nusage and lower workflow execution costs."}),"\n",(0,i.jsx)(s.p,{children:"The figure below illustrates the relationships between the GATK-SV Docker images."}),"\n",(0,i.jsx)(s.mermaid,{value:"flowchart TD\n    ubuntu2204[Ubuntu 22.04] --\x3e svbasemini[sv-base-mini] & samtoolsenv[samtools-cloud-virtual-env] & svbaseenv[sv-base-virtual-env]\n    svbasemini & samtoolsenv & svbaseenv --\x3e svpipelineenv[sv-pipeline-virtual-env]\n    samtoolsenv --\x3e samtoolscloud[samtools-cloud] & svutilsenv[sv-utils-env]\n    svbasemini --\x3e samtoolscloud\n    svutilsenv --\x3e svutils[sv-utils]\n    samtoolscloud --\x3e svutils & svbase[sv-base]\n    svpipelineenv & svbase --\x3e svpipeline[sv-pipeline]\n    svbaseenv --\x3e cnmopsenv[cnmpos-virtual-env]\n    svbase & cnmopsenv --\x3e cnmpos[cnmops]\n\n    ubuntu1804[Ubuntu 18.04] --\x3e melt[MELT] & wham[Wham]\n    samtoolscloud --\x3e wham\n    ubuntu2210[Ubuntu 22.10] --\x3e str[STR]\n    ubuntu2204 --\x3e scramble[Scramble] & manta[Manta]"}),"\n",(0,i.jsx)(s.p,{children:"The image depicts the hierarchical relationship among GATK-SV\nDocker images. Arrows indicate the flow from a base image\nto a derived image. The base image, located at the arrow's\nstarting point, shares its content which is then expanded\nupon and modified in the derived image. In simple terms,\nthe derived image inherits the same tools and configuration\nas the base image, while incorporating additional settings and tools."}),"\n",(0,i.jsxs)(s.p,{children:["The list of the Docker images and their latest builds\nare available in ",(0,i.jsx)(s.a,{href:"https://github.com/broadinstitute/gatk-sv/blob/main/inputs/values/dockers.json",children:(0,i.jsx)(s.code,{children:"dockers.json"})}),"\nand ",(0,i.jsx)(s.a,{href:"https://github.com/broadinstitute/gatk-sv/blob/main/inputs/values/dockers_azure.json",children:(0,i.jsx)(s.code,{children:"dockers_azure.json"})}),"\nfor images hosted on Google Container Registry (GCR) and Azure Container Registry (ACR), respectively."]}),"\n",(0,i.jsx)(s.h2,{id:"list",children:"Docker Images List"}),"\n",(0,i.jsx)(s.p,{children:"The table below lists the GATK-SV Docker images and their dependencies."}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Image"}),(0,i.jsx)(s.th,{children:"Code Dependencies"}),(0,i.jsx)(s.th,{children:"Docker Dependencies"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"manta"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"dockerfiles/manta/*"})})})}),(0,i.jsx)(s.td,{})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"melt"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"dockerfiles/melt/*"})})})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"sv-base"})})})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"scramble"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"dockerfiles/scramble/*"})})})}),(0,i.jsx)(s.td,{})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"wham"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"dockerfiles/wham/*"})})})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"samtools-cloud"})})})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"str"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"dockerfiles/str/*"})})})}),(0,i.jsx)(s.td,{})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"sv-base-mini"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"dockerfiles/sv-base-mini/*"})})})}),(0,i.jsx)(s.td,{})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"samtools-cloud-virtual-env"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"dockerfiles/samtools-cloud-virtual-env/*"})})})}),(0,i.jsx)(s.td,{})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"samtools-cloud"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"dockerfiles/samtools-cloud/*"})})})}),(0,i.jsx)(s.td,{children:(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"sv-base-mini"})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"samtools-cloud-virtual-env"})})]})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"sv-base-virtual-env"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"dockerfiles/sv-base-virtual-env/*"})})})}),(0,i.jsx)(s.td,{})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"sv-base"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"dockerfiles/sv-base/*"})})})}),(0,i.jsx)(s.td,{children:(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"samtools-cloud"})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"sv-base-virtual-env"})})]})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"cnmops-virtual-env"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"dockerfiles/cnmops-virtual-env/*"})})})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"sv-base-virtual-env"})})})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"cnmops"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"dockerfiles/cnmops/*"})})})}),(0,i.jsx)(s.td,{children:(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"sv-base"})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"cnmops-virtual-env"})})]})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"sv-pipeline-virtual-env"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"dockerfiles/sv-pipeline-virtual-env/*"})})})}),(0,i.jsx)(s.td,{children:(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"sv-base-mini"})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"sv-base-virtual-env"})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"samtools-cloud-virtual-env"})})]})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"sv-pipeline"})}),(0,i.jsx)(s.td,{children:(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"dockerfiles/sv-pipeline/*"})}),(0,i.jsxs)("li",{children:[" ",(0,i.jsx)(s.code,{children:"src/RdTest/*"})]}),(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"src/sv-pipeline/*"})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"src/svqc/*"})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"src/svtest/*"})}),(0,i.jsxs)("li",{children:[" ",(0,i.jsx)(s.code,{children:"src/svtk/*"})]}),(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"src/WGD/*"})})]})}),(0,i.jsx)(s.td,{children:(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"sv-base"})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"sv-pipeline-virtual-env"})})]})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"sv-utils-env"})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"dockerfiles/sv-utils-env/*"})})})}),(0,i.jsx)(s.td,{children:(0,i.jsx)("ul",{children:(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"samtools-cloud-virtual-env"})})})})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:(0,i.jsx)(s.code,{children:"sv-utils"})}),(0,i.jsx)(s.td,{children:(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"dockerfiles/sv-utils/*"})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"src/sv_utils/src/*"})}),(0,i.jsxs)("li",{children:[" ",(0,i.jsx)(s.code,{children:"src/sv_utils/setup.py"})]})]})}),(0,i.jsx)(s.td,{children:(0,i.jsxs)("ul",{children:[(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"samtools-cloud"})}),(0,i.jsx)("li",{children:(0,i.jsx)(s.code,{children:"sv-utils-env"})})]})})]})]})]}),"\n",(0,i.jsx)(s.h2,{id:"advantages-of-dividing-images-by-functionality",children:"Advantages of Dividing Images by Functionality"}),"\n",(0,i.jsx)(s.p,{children:"The GATK-SV pipeline utilizes Docker images to encapsulate the necessary tools,\ndependencies, and configurations. Instead of having a single monolithic image,\nthe pipeline is organized into multiple smaller images, each focusing on a specific task.\nThis approach offers several benefits."}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Modular and focused structure:"}),"\nEach image includes task-specific tools, simplifying the use and maintenance of\nGATK-SV Docker images for users and developers, respectively."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Reduced Docker image size:"}),"\nUsing task-specific Docker images reduces sizes, requiring less storage space\nin container registries. It also enables faster image transfer\nwhen creating virtual machines for task execution."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Enhanced maintenance and extensibility:"}),"\nMaintainers can easily modify specific tools or configurations within\na single image without affecting others, improving maintainability and\nfacilitating seamless expansion by adding or replacing tools as required."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"Consistency and efficiency:"}),"\nBuilding images on top of existing setups and tools promotes code\nreuse and reduces duplication, ensuring consistent configurations\nacross pipeline stages. It simplifies dependency management by\nallowing changes or updates at the appropriate level, cascading\ndown to dependent images."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"In summary, splitting tools into smaller, task-specific\nDocker images optimizes storage, execution, maintenance, and extensibility.\nIt enhances consistency, code reuse, and dependency management,\nensuring efficient and scalable pipeline execution."})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},9365:(e,s,n)=>{n.d(s,{A:()=>t});n(6540);var i=n(4164);const r={tabItem:"tabItem_Ymn6"};var l=n(4848);function t(e){let{children:s,hidden:n,className:t}=e;return(0,l.jsx)("div",{role:"tabpanel",className:(0,i.A)(r.tabItem,t),hidden:n,children:s})}},1470:(e,s,n)=>{n.d(s,{A:()=>y});var i=n(6540),r=n(4164),l=n(3104),t=n(6347),c=n(205),d=n(7485),a=n(1682),o=n(9466);function h(e){return i.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:s}=e;return!!s&&"object"==typeof s&&"value"in s}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:s,children:n}=e;return(0,i.useMemo)((()=>{const e=s??function(e){return h(e).map((e=>{let{props:{value:s,label:n,attributes:i,default:r}}=e;return{value:s,label:n,attributes:i,default:r}}))}(n);return function(e){const s=(0,a.X)(e,((e,s)=>e.value===s.value));if(s.length>0)throw new Error(`Docusaurus error: Duplicate values "${s.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[s,n])}function x(e){let{value:s,tabValues:n}=e;return n.some((e=>e.value===s))}function j(e){let{queryString:s=!1,groupId:n}=e;const r=(0,t.W6)(),l=function(e){let{queryString:s=!1,groupId:n}=e;if("string"==typeof s)return s;if(!1===s)return null;if(!0===s&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:s,groupId:n});return[(0,d.aZ)(l),(0,i.useCallback)((e=>{if(!l)return;const s=new URLSearchParams(r.location.search);s.set(l,e),r.replace({...r.location,search:s.toString()})}),[l,r])]}function m(e){const{defaultValue:s,queryString:n=!1,groupId:r}=e,l=u(e),[t,d]=(0,i.useState)((()=>function(e){let{defaultValue:s,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(s){if(!x({value:s,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${s}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return s}const i=n.find((e=>e.default))??n[0];if(!i)throw new Error("Unexpected error: 0 tabValues");return i.value}({defaultValue:s,tabValues:l}))),[a,h]=j({queryString:n,groupId:r}),[m,v]=function(e){let{groupId:s}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(s),[r,l]=(0,o.Dv)(n);return[r,(0,i.useCallback)((e=>{n&&l.set(e)}),[n,l])]}({groupId:r}),p=(()=>{const e=a??m;return x({value:e,tabValues:l})?e:null})();(0,c.A)((()=>{p&&d(p)}),[p]);return{selectedValue:t,selectValue:(0,i.useCallback)((e=>{if(!x({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);d(e),h(e),v(e)}),[h,v,l]),tabValues:l}}var v=n(2303);const p={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var g=n(4848);function f(e){let{className:s,block:n,selectedValue:i,selectValue:t,tabValues:c}=e;const d=[],{blockElementScrollPositionUntilNextRender:a}=(0,l.a_)(),o=e=>{const s=e.currentTarget,n=d.indexOf(s),r=c[n].value;r!==i&&(a(s),t(r))},h=e=>{let s=null;switch(e.key){case"Enter":o(e);break;case"ArrowRight":{const n=d.indexOf(e.currentTarget)+1;s=d[n]??d[0];break}case"ArrowLeft":{const n=d.indexOf(e.currentTarget)-1;s=d[n]??d[d.length-1];break}}s?.focus()};return(0,g.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":n},s),children:c.map((e=>{let{value:s,label:n,attributes:l}=e;return(0,g.jsx)("li",{role:"tab",tabIndex:i===s?0:-1,"aria-selected":i===s,ref:e=>d.push(e),onKeyDown:h,onClick:o,...l,className:(0,r.A)("tabs__item",p.tabItem,l?.className,{"tabs__item--active":i===s}),children:n??s},s)}))})}function b(e){let{lazy:s,children:n,selectedValue:r}=e;const l=(Array.isArray(n)?n:[n]).filter(Boolean);if(s){const e=l.find((e=>e.props.value===r));return e?(0,i.cloneElement)(e,{className:"margin-top--md"}):null}return(0,g.jsx)("div",{className:"margin-top--md",children:l.map(((e,s)=>(0,i.cloneElement)(e,{key:s,hidden:e.props.value!==r})))})}function k(e){const s=m(e);return(0,g.jsxs)("div",{className:(0,r.A)("tabs-container",p.tabList),children:[(0,g.jsx)(f,{...s,...e}),(0,g.jsx)(b,{...s,...e})]})}function y(e){const s=(0,v.A)();return(0,g.jsx)(k,{...e,children:h(e.children)},String(s))}},8453:(e,s,n)=>{n.d(s,{R:()=>t,x:()=>c});var i=n(6540);const r={},l=i.createContext(r);function t(e){const s=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(l.Provider,{value:s},e.children)}}}]);