"use strict";(self.webpackChunkGATK_SV=self.webpackChunkGATK_SV||[]).push([[2986],{4207:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>d,toc:()=>o});var t=n(4848),s=n(8453);const r={title:"Incremental Publishing",description:"Incremental Publishing Strategy",sidebar_position:4},a=void 0,d={id:"advanced/docker/deploy/incremental",title:"Incremental Publishing",description:"Incremental Publishing Strategy",source:"@site/docs/advanced/docker/deploy/incremental.md",sourceDirName:"advanced/docker/deploy",slug:"/advanced/docker/deploy/incremental",permalink:"/gatk-sv/docs/advanced/docker/deploy/incremental",draft:!1,unlisted:!1,editUrl:"https://github.com/broadinstitute/gatk-sv/tree/master/website/docs/advanced/docker/deploy/incremental.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{title:"Incremental Publishing",description:"Incremental Publishing Strategy",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Manual Deployment",permalink:"/gatk-sv/docs/advanced/docker/deploy/manual"}},c={},o=[{value:"Determining Modified Files",id:"determining-modified-files",level:2},{value:"Identifying Images Requiring Rebuilding from Changed Files",id:"identifying-images-requiring-rebuilding-from-changed-files",level:2}];function l(e){const i={a:"a",code:"code",h2:"h2",li:"li",mermaid:"mermaid",ol:"ol",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(i.p,{children:["The hierarchical and modular organization of GATK-SV Docker\nimages offers a significant advantage: when updating the codebase,\nnot every Docker image is affected, minimizing the impact of changes.\nThis means that not all Docker images need to be rebuilt and\npublished with each pipeline modification. The\n",(0,t.jsx)(i.a,{href:"https://github.com/broadinstitute/gatk-sv/blob/main/scripts/docker/build_docker.py",children:(0,t.jsx)(i.code,{children:"build_docker"})}),"\nscript efficiently tracks these changes and determines which\nDocker images are impacted. Consequently, only the affected Docker\nimages are built, saving both storage space and build time."]}),"\n",(0,t.jsx)(i.p,{children:"This incremental and selective building and publishing\nstrategy is particularly beneficial considering the size and\nbuild time of Docker images. By building and publishing\nonly the necessary images, we can save on storage space and\nreduce the overall build time.\nThis page provides a detailed explanation of\nthis incremental and selective approach."}),"\n",(0,t.jsx)(i.h2,{id:"determining-modified-files",children:"Determining Modified Files"}),"\n",(0,t.jsxs)(i.p,{children:["The incremental build strategy relies on the determination\nof modified files to identify which Docker images require rebuilding.\nUsing ",(0,t.jsx)(i.code,{children:"git"})," history, the ",(0,t.jsx)(i.code,{children:"build_docker"})," script automatically\ninfers the list of changed files."]}),"\n",(0,t.jsxs)(i.p,{children:["To achieve this, the script compares two\n",(0,t.jsxs)(i.a,{href:"https://docs.github.com/en/pull-requests/committing-changes-to-your-project/creating-and-editing-commits/about-commits",children:[(0,t.jsx)(i.code,{children:"git"})," commit SHAs"]}),":"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"BASE_SHA"}),": the reference commit representing the base branch\n(e.g., ",(0,t.jsx)(i.code,{children:"broadinstitute/gatk-sv:main"}),"), and;"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.code,{children:"HEAD_SHA"}),": the target commit representing the latest commit on the feature branch."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"By analyzing the changes between these commits\nthe script identifies the impacted files and proceeds to\nbuild the corresponding Docker images."}),"\n",(0,t.jsx)(i.p,{children:"During manual runs, the user provides the commit SHAs,\nwhile in automated builds as part of CI/CD,\nthe commit SHAs are determined automatically."}),"\n",(0,t.jsx)(i.p,{children:"In CI/CD, the commit SHAs are determined as the following example."}),"\n",(0,t.jsx)(i.mermaid,{value:'%%{init: { \n            \'logLevel\': \'debug\',\n            \'gitGraph\': {\'rotateCommitLabel\': false}, \n            \'themeVariables\': { \'commitLabelFontSize\': \'22px\' } \n         } \n   }%%\ngitGraph\n   commit id: "A"\n   commit id: "B"\n   branch feature\n   checkout feature\n   commit id: "X"\n   checkout main\n   commit id: "C"\n   checkout feature\n   commit id: "Y"\n   checkout main\n   commit id: "D"\n   checkout feature\n   commit id: "Z"\n   checkout main\n   merge feature id: "E"\n   commit id: "F"'}),"\n",(0,t.jsxs)(i.p,{children:["In this example, ",(0,t.jsx)(i.code,{children:"BASE_SHA=B"}),", ",(0,t.jsx)(i.code,{children:"HEAD_SHA=Z"}),", and ",(0,t.jsx)(i.code,{children:"E"})," is the merge commit."]}),"\n",(0,t.jsx)(i.h2,{id:"identifying-images-requiring-rebuilding-from-changed-files",children:"Identifying Images Requiring Rebuilding from Changed Files"}),"\n",(0,t.jsxs)(i.p,{children:["The ",(0,t.jsx)(i.code,{children:"build_docker"})," script identifies the list of docker images\nthat need to be rebuilt based on two factors."]}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsx)(i.p,{children:"Directly impacted images are determined by checking the\nlist of files each image depends on. If any of these files have\nchanged, the corresponding image needs rebuilding."}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsx)(i.p,{children:"Indirectly impacted images are identified based on\nthe hierarchical dependency between images.\nIf a base image is rebuilt, any dependent images built upon\nit also require rebuilding."}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:"This two-step process ensures that all the affected images are correctly\nidentified for rebuilding."}),"\n",(0,t.jsxs)(i.p,{children:["A comprehensive mapping of files to their corresponding\nDocker images, specifying which images need to be\nrebuilt when their associated files are updated is given in\n",(0,t.jsx)(i.a,{href:"https://github.com/broadinstitute/gatk-sv/blob/e86d59962146ae1770c535a97c2774d825026957/scripts/docker/build_docker.py#L170-L245",children:"this section"}),"."]})]})}function h(e={}){const{wrapper:i}={...(0,s.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>a,x:()=>d});var t=n(6540);const s={},r=t.createContext(s);function a(e){const i=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function d(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(r.Provider,{value:i},e.children)}}}]);